clear; clc;
temp_init = 25; % (deg C)
temp_range = [10,20,30,40]; % (deg C)
deltaT = 0.05;
% terminal voltages were generated randomly between 3.5 & 3.9 volts
%term_volt = 3.5 + 0.4*rand(12,1);
term_volt = [3.59263775468341
3.69555909756807
3.74962403526948
3.77165421634630
3.65820608626744
3.64697465941779
3.89519280126465
3.51509554649582
3.85406720328099
3.86531473105570
3.81847354943409
3.53948491146223]';


%%%%%%%%  Begin-Of-Life Characterstics From TWAICE Cell Model Parameter Extraction %%%%%%%%
bol_cell_cap = 75*2; % bol cell capacity (AHr)
% doubled capacity since there are 2 cells in parallel
bol_soc = [0.140016,0.235420,0.330867,0.426343,0.521842,0.617364,0.712935,0.808565,0.904255,1]; % bol soc

% cell bol open circuit voltage (Volts)
bol_ocv = [3.3975	3.4035	3.4044	3.4050;
3.5028	3.5067	3.5066	3.5066;
3.5759	3.5803	3.5824	3.5834;
3.6244	3.6284	3.6304	3.6315;
3.6853	3.6903	3.6930	3.6945;
3.7952	3.8027	3.8061	3.8080;
3.8889	3.8916	3.8935	3.8946;
3.9755	3.9778	3.9796	3.9807;
4.0691	4.0708	4.0720	4.0728;
4.1475	4.1480	4.1484	4.1487;]; 

% cell bol ohmic resistance (mOhms)
bol_ohmic_res = [1.12177 0.92724 0.79274 0.76689;
0.97609	0.82606	0.74399	0.71282;
0.96244	0.80497	0.72921	0.69110;
0.97474	0.80159	0.72664	0.68371;
0.99720	0.81236	0.73589	0.68844;
1.03808	0.83480	0.75409	0.70016;
1.07699	0.86186	0.75871	0.69451;
1.11867	0.89312	0.76670	0.69186;
1.17035	0.92572	0.77467	0.69184;
1.24079	0.97372	0.79555	0.70356;]./2;
% halved resistance since there are 2 cells in parallel

% cell bol first polarization resistance (mOhms)
bol_first_pol_res = [3.01932 2.62931 2.35436 2.34669;
2.17586	2.00470	1.83440	1.81003;
1.48109	1.44399	1.40928	1.40689;
1.20044	1.15806	1.10616	1.08703;
1.28306	1.23494	1.18073	1.15339;
1.86849	1.85313	1.78057	1.73867;
1.72999	1.60846	1.49975	1.42231;
1.71855	1.61514	1.51253	1.42396;
1.89192	1.74794	1.61482	1.48995;
1.59195	1.44321	1.32675	1.21922;]./2;
% halved resistance since there are 2 cells in parallel

% cell bol first time constant (s)
bol_first_time_const = [358	358	358	358;
358	358	358	358;
358	358	358	358;
358	358	358	358;
358	358	358	358;
358	358	358	358;
358	358	358	358;
358	358	358	358;
358	358	358	358;
358	358	358	358;]./5;


%%%%%%%%  End-Of-Life Characterstics From TWAICE Cell Model Parameter Extraction %%%%%%%%
eol_cell_cap = 60*2; % eol cell capacity (AHr)
% doubled capacity since there are 2 cells in parallel
eol_soc = [0,0.045531348,0.164652975,0.283795622,0.402964209,0.522190573,0.641482046,0.760858074,0.880355752,1]; % eol soc

% cell eol open circuit voltage (Volts)
eol_ocv = [2.8005	2.8001	2.8001	2.8001;
3.2574	3.2732	3.2789	3.2805;
3.4285	3.4318	3.4327	3.4331;
3.5462	3.5483	3.5488	3.5492;
3.6143	3.6171	3.6189	3.6192;
3.6871	3.6913	3.6937	3.6945;
3.8239	3.8286	3.8310	3.8320;
3.9288	3.9311	3.9327	3.9336;
4.0523	4.0542	4.0556	4.0565;
4.1475	4.1480	4.1484	4.1487;]; 

% cell eol ohmic resistance (mOhms)
eol_ohmic_res = [2.36317 2.26666 2.26666 2.26666;
2.30089	1.99008	1.92214	1.91929;
1.76492	1.57518	1.46559	1.46500;
1.63248	1.50152	1.37473	1.37454;
1.65804	1.49460	1.35451	1.33937;
1.75591	1.52983	1.38668	1.34727;
1.88614	1.57038	1.42112	1.35170;
2.02530	1.61083	1.45288	1.34817;
2.20853	1.74253	1.49208	1.34691;
2.45134	1.91552	1.56245	1.37319;]./2;
% halved resistance since there are 2 cells in parallel 

% cell eol first polarization resistance (mOhms)
eol_first_pol_res = [1.10151 1.19315 1.19315 1.19315;
7.48251	7.77829	7.92137	7.94579;
4.14062	3.59236	3.50597	3.48728;
2.74709	2.54399	2.47096	2.46965;
1.88744	1.85018	1.79293	1.80781;
1.82863	1.79577	1.69427	1.70862;
2.56216	2.52142	2.35549	2.33930;
2.34749	2.24668	2.01777	1.93994;
2.76596	2.55926	2.38490	2.24480;
2.28875	2.03117	1.85234	1.67327;]./2;
% halved resistance since there are 2 cells in parallel

% cell eol first time constant (s)
eol_first_time_const = [358	358	358	358;
358	358	358	358;
358	358	358	358;
358	358	358	358;
358	358	358	358;
358	358	358	358;
358	358	358	358;
358	358	358	358;
358	358	358	358;
358	358	358	358;]./5;


%%%%%%%%  Begin-Of-Life Characterstics From HPPC Module ECM Parameters %%%%%%%%
%%%%%  (module parameters scaled down to cell-pair level in model itself) %%%%%

soc_range = [0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9]; % soc levels
module_capacity = 150; % module capacity (Ahr)

% cell charging ocv (Volts)
ocv_charge = [3.411,3.4045,3.405,3.406;
3.529,3.524,3.524,3.525;
3.589,3.589,3.59,3.592;
3.638,3.638,3.639,3.642;
3.706,3.7055,3.708,3.711;
3.832,3.8295,3.83,3.831;
3.916,3.915,3.916,3.916;
4.006,4.007,4.007,4.008;
4.086,4.085,4.086,4.087;]; 

% cell discharging ocv (Volts)
cell_ocv_discharge = [3.387,3.3855,3.385,3.385;
3.502,3.4965,3.497,3.496;
3.577,3.577,3.579,3.581;
3.625,3.627,3.629,3.631;
3.69,3.6925,3.695,3.697;
3.818,3.821,3.822,3.822;
3.907,3.908,3.909,3.909;
3.999,4.001,4.002,4.001;
4.082,4.082,4.083,4.084;]; 

% module net ocv (Volts)
module_ocv_net = (ocv_charge + cell_ocv_discharge)*12/2; 

% module discharge ohmic resistance (mOhms)
ohmic_res_discharge = [6.556865079,5.427333333,4.425111111,4.245777778;
6.736222222,4.936444444,4.090222222,3.833333333;
6.437777778,4.825111111,4.026444444,3.717555556;
6.242666667,4.778666667,4.016888889,3.682888889;
6.124666667,4.717555556,3.981777778,3.659111111;
6.014666667,4.696444444,3.976888889,3.645333333;
6.031555556,4.749111111,4.026,3.652666667;
6.105555556,4.805333333,4.064666667,3.659333333;
6.238666667,4.984,4.215555556,3.686;];  

% module charge ohmic resistance (mOhms)
ohmic_res_charge = [6.498281089,5.36625,4.38375,4.21925;
6.6835,4.9205,4.08975,3.83175;
6.43,4.7845,4.00025,3.707;
6.2075,4.73925,3.97275,3.6355;
6.0905,4.68725,3.95975,3.653;
5.9875,4.671,3.98175,3.64525;
6.01475,4.696,3.987,3.63075;
6.13373494,4.771,4.0528,3.6476;
6.269277108,4.9445,4.174,3.6932;];

% module first polarization discharging resistance (mOhm)
first_pol_res_discharge = [1.196117703,3.652046781,1.438472652,1.515799628;
1.389884993,0.911462073,0.921369712,0.872852521;
1.085916739,0.945556684,1.124863965,1.033485234;
0.974257172,0.976517271,0.872490415,0.849795009;
0.991500501,0.936145727,0.965068532,0.830231887;
1.295774635,1.04739441,0.984676149,0.919076679;
1.069521662,1.071097242,1.021389752,0.820375886;
1.115677694,1.087186316,1.053142951,1.819136981;
1.10329358,0.963297884,0.948404842,0.944065227;];

% module first polarization charging resistance (mOhm)
first_pol_res_charge = [1.011740613,1.157493973,1.120500531,1.057278937;
1.07803289,1.015151947,1.179790798,1.1851649;
1.068982115,1.317496899,0.905365184,0.730592839;
1.046575326,1.087376363,0.816430772,0.709556459;
1.120669603,1.219276968,0.99931082,1.006460619;
1.116541377,1.00054805,1.064387601,0.996740661;
1.193899982,0.973102904,1.182420027,0.864515152;
1.068900462,1.340802796,0.869443726,1.113073299;
1.323151159,1.287226023,1.081679962,0.786446026;];

% module first polarization resistance (mOhm)
first_pol_res = ((first_pol_res_charge + first_pol_res_discharge)/2);

% module first discharging time constant (s)
first_time_const_discharge = [3.717371349,2.144729973,3.752058603,5.039913857;
3.451056594,1.846996869,4.244801924,3.839964635;
3.413610842,4.1565828,7.450070944,7.227897732;
3.384329101,4.507575133,4.33970288,6.02812279;
3.068383706,3.656391351,5.225483334,5.263016047;
3.393945354,2.809213155,2.994032551,3.231134394;
1.963928581,0.607444896,2.542686547,3.789372366;
2.765328179,1.45053341,2.821620883,14.20102314;
2.56533065,1.639216179,3.747637345,5.923602766;];

% module first charging time constant (s)
first_time_const_charge = [2.158277377,1.626642958,4.995244995,4.579207237;
2.869352764,4.833565364,7.893915501,7.998763516;
4.016044497,8.971429932,6.092001095,3.616462552;
3.547181941,6.604213801,4.60164987,3.16991698;
2.997045358,7.169547118,6.194095044,6.216978978;
3.060551501,3.670575054,6.045154158,6.406925686;
4.550782316,3.933510332,7.782498587,4.949804473;
4.239560491,7.355429073,3.026459268,8.035968946;
7.412917522,8.318762929,7.61055854,5.599352742;];

% module first time constant (s)
first_time_const = ((first_time_const_charge + first_time_const_discharge)/2);

% module second polarization resistance (mOhm)
second_pol_res = [4.604829812,6.347286942,4.126604008,2.619409304;
4.996666004,5.185872507,3.534980449,2.947016037;
5.315389773,5.435822924,4.559893677,2.611319802;
5.944556045,4.282936753,3.668145483,3.109287382;
8.075372509,3.818331021,3.054914021,3.854715936;
5.024944352,7.959339821,7.002858338,2.149965374;
5.477816307,5.883096599,4.463121331,2.535612915;
6.925738314,4.160172172,3.148238348,3.423999612;
9.184258127,5.131371379,4.436334134,4.12221142;];

% module second time constant (s)
second_time_const = [40.67022316,56.02552642,36.52111786,22.9437206;
44.15553664,45.75656441,31.37827638,25.94685025;
47.03259995,48.47188966,40.41716735,22.75983909;
52.30608973,38.04321509,32.69827941,27.44485716;
71.76125988,34.07488671,26.80465306,34.45659592;
44.44497018,70.75796606,61.9801045,18.72954025;
48.58299248,52.15224106,39.39162452,22.27158048;
61.17184086,37.00421022,27.95411968,30.55379108;
81.3777808,45.73504839,39.22671812,36.57201848;];